<template>
  <div class="info">
    <el-card class="box-card">
      <div slot="header" class="clearfix">
        <!-- sÊêúÁ¥¢Âå∫ -->
        <div class="container">
          <el-form inline size="small" :label-position="labelPosition">

            <!-- <el-form-item label="ÊúçÂä°ËåÉÂõ¥">
              <el-select
                v-model="infoForm.services"
                clearable
                placeholder="ËØ∑ÈÄâÊã©"
                class="selWidth"
                @change="get_list(1)"
              />
            </el-form-item> -->

            <el-form-item label="ÂëòÂ∑•Ë¥¶Âè∑Ôºö" style="display:inline-block">
              <el-input v-model="infoForm.account" placeholder="ËØ∑ËæìÂÖ•ÂëòÂ∑•Ë¥¶Âè∑" clearable />
            </el-form-item>

            <el-form-item label="ÂëòÂ∑•ÂßìÂêçÔºö" style="display:inline-block">
              <el-input v-model="infoForm.real_name" placeholder="ËØ∑ËæìÂÖ•ÂëòÂ∑•ÂßìÂêç" clearable />
            </el-form-item>

            <el-form-item label="ÂëòÂ∑•Áä∂ÊÄÅ">
              <el-select
                v-model="infoForm.state_id"
                placeholder="ËØ∑ÈÄâÊã©"
                class="selWidth"
                @change="get_list(1)"
              >
                <el-option
                  v-for="item in state_list"
                  :key="item.id"
                  :label="item.name"
                  :value="item.id">
                </el-option>
              </el-select>
            </el-form-item>

            <el-button class="ResetSearch mr10" size="small" type="reset" @click="reset('infoForm')">ÈáçÁΩÆ</el-button>
            <el-button type="primary" label="default" size="small" @click="info_search">Êü•ËØ¢</el-button>
          </el-form>
        </div>
        <!-- eÊêúÁ¥¢Âå∫ -->

        <el-button type="primary" label="default" size="small" @click="add_click()">Êñ∞Â¢ûÂëòÂ∑•</el-button>
        <!-- üëáÂèØ‰ª•ÊîπÊàêÂú®ÊêúÁ¥¢ÂéªÊ∑ªÂä†‰∏Ä‰∏™ÊòØÂê¶ÊòØÂ∑≤Âà†Èô§ÂëòÂ∑•ÁöÑÊêúÁ¥¢Êù°‰ª∂ -->
        <!-- <el-button v-if="is_del == 0" type="danger" label="default" size="small" @click="had_del_staff">Â∑≤Âà†Èô§ÂëòÂ∑•</el-button>
        <el-button v-else type="success" label="default" size="small" @click="had_nodel_staff">Âú®Á∫øÂëòÂ∑•</el-button> -->
      </div>

      <!-- sË°®Ê†º -->
      <el-table :data="tableData.data" style="width: 100%" size="small" highlight-current-row>

        <el-table-column prop="real_name" label="ÂëòÂ∑•" min-width="100" />

        <!--<el-table-column label="ËßíËâ≤" min-width="100" >-->
        <!--  <template slot-scope="scope">-->
        <!--    <el-tooltip class="item" effect="dark" :content="scope.row.role_list_str" placement="top-start">-->
        <!--      <el-button size="mini">{{scope.row.role_list_str.slice(0,5)}}...</el-button>-->
        <!--    </el-tooltip>-->
        <!--  </template>-->
        <!--</el-table-column>-->

        <!--<el-table-column label="ÊúçÂä°ËåÉÂõ¥" min-width="100" >-->
        <!--  <template slot-scope="scope">-->
        <!--    <el-tooltip class="item" effect="dark" :content="scope.row.mer_list_str" placement="top-start">-->
        <!--      <el-button size="mini">{{scope.row.mer_list_str.slice(0,5)}}...</el-button>-->
        <!--    </el-tooltip>-->
        <!--  </template>-->
        <!--</el-table-column>-->

        <el-table-column prop="account" label="ÂëòÂ∑•Ë¥¶Âè∑" min-width="100" />

        <el-table-column prop="group_name" label="ËßíËâ≤" min-width="100" >
          <template slot-scope="scope">
            {{get_role_name(scope.row)}}
          </template>
        </el-table-column>
        
        <el-table-column prop="state_name" label="ÂëòÂ∑•Áä∂ÊÄÅ" min-width="100" />

        <el-table-column label="Êìç‰Ωú" min-width="120" fixed="right" align="center">
          <template slot-scope="scope">
            <el-button v-if="!is_del" type="text" size="small" class="mr10" @click="change_pwd(scope.row)">‰øÆÊîπÂØÜÁ†Å</el-button>
            <el-button v-if="!is_del && is_max(scope.row)" type="text" size="small" class="mr10" @click="edit(scope.row.admin_id)">ÁºñËæë</el-button>
            <el-button v-if="!is_del && is_max(scope.row)" type="text" size="small" class="mr10" @click="del(scope.row)">Âà†Èô§</el-button>
            <el-button v-if="!is_del" type="text" size="small" class="mr10" @click="edit_state(scope.row)">ÁºñËæëÂëòÂ∑•Áä∂ÊÄÅ</el-button>
            <el-button v-if="is_del" type="text" size="small" class="mr10" @click="recover(scope.row)">ÊÅ¢Â§ç</el-button>
          </template>
        </el-table-column>
      </el-table>

      <div class="block">
        <el-pagination
          :page-sizes="[10, 20, 40, 60, 80]"
          :page-size="infoForm.limit"
          :current-page="infoForm.page"
          layout="total, sizes, prev, pager, next, jumper"
          :total="tableData.total"
          @size-change="handle_size_change"
          @current-change="page_change"
        />
      </div>
      <!-- eË°®Ê†º -->

    </el-card>

    <!-- sÊñ∞Â¢ûÂëòÂ∑• -->
    <el-dialog title="Êñ∞Â¢ûÂëòÂ∑•" :visible.sync="add_visible" :close-on-click-modal="false" class="add_staff" width="70%">

      <el-form ref="addForm" :model="addForm" :rules="addRules">

        <el-form-item label="ÂëòÂ∑•Â∏êÂè∑Ôºö" :label-width="formLabelWidth" prop="account">
          <el-input v-model="addForm.account" autocomplete="off" placeholder="ËØ∑ËæìÂÖ•ÂëòÂ∑•Â∏êÂè∑" @change="check_account(addForm.account)"/>
        </el-form-item>

        <el-form-item label="ÂëòÂ∑•ÂßìÂêçÔºö" :label-width="formLabelWidth" prop="real_name">
          <el-input v-model="addForm.real_name" autocomplete="off" placeholder="ËØ∑ËæìÂÖ•ÂëòÂ∑•ÂßìÂêç" />
        </el-form-item>

        <!-- sÊÄªÈó®Â∫óËßíËâ≤ -->

        <!-- <el-table :data="allAddWorkInfo" :header-cell-style="{background:'#F5F7FA',color:'#2F3033',fontWeight:'normal'}" style="width: 100%" size="small" highlight-current-row>
          <el-table-column label="ËØ∑ÈÄâÊã©ËßíËâ≤" min-width="100">
            <template slot-scope="scope">
                <el-select v-model="scope.row.role_id" placeholder="ËØ∑ÈÄâÊã©ËßíËâ≤" @change="my_select(scope.row,scope.$index,'allAddWorkInfo')">
                  <el-option
                    v-for="item in admin_role_list"
                    :key="item.role_id"
                    :label="item.role_name"
                    :value="item.role_id"
                  />
                </el-select>
            </template>
          </el-table-column>

          <el-table-column label="Êìç‰Ωú" min-width="120" fixed="right" align="center">
            <template slot-scope="scope">
              <el-button type="text" size="small" class="mr10" @click="all_del_role(scope.$index,'allAddWorkInfo')">Âà†Èô§</el-button>
            </template>
          </el-table-column>
        </el-table>
        <el-button size="small" class="addBtn" @click="all_add_role">Ê∑ªÂä†</el-button> -->
        <!-- sÊÄªÈó®Â∫óËßíËâ≤ -->

        <div style="margin-top: 10px;"></div>

      </el-form>

      <div slot="footer" class="dialog-footer">
        <el-button type="primary" @click="add_submit('addForm')">‰øùÂ≠ò‰øÆÊîπ</el-button>
      </div>
    </el-dialog>
    <!-- eÊñ∞Â¢ûÂëòÂ∑• -->

    <!-- sÁºñËæëÂëòÂ∑•‰ø°ÊÅØ -->
    <el-dialog title="ÁºñËæëÂëòÂ∑•" :visible.sync="edit_visible" :close-on-click-modal="false" class="add_staff" width="70%">

      <el-form ref="editForm" :model="editForm" :rules="editRules">

        <el-form-item label="ÂëòÂ∑•Â∏êÂè∑Ôºö" :label-width="formLabelWidth" prop="account">
          <el-input v-model="editForm.account" autocomplete="off" placeholder="ËØ∑ËæìÂÖ•ÂëòÂ∑•Â∏êÂè∑" disabled/>
        </el-form-item>

        <el-form-item label="ÂëòÂ∑•ÂßìÂêçÔºö" :label-width="formLabelWidth" prop="real_name">
          <el-input v-model="editForm.real_name" autocomplete="off" placeholder="ËØ∑ËæìÂÖ•ÂëòÂ∑•ÂßìÂêç" />
        </el-form-item>

        <!-- sÊÄªÈó®Â∫óËßíËâ≤ -->
        <!-- <el-table :data="allEditWorkInfo" :header-cell-style="{background:'#F5F7FA',color:'#2F3033',fontWeight:'normal'}" style="width: 100%" size="small" highlight-current-row>

          <el-table-column prop="role" label="ÊÄªÂêéÂè∞ËßíËâ≤" min-width="100">
            <template slot-scope="scope">
              <el-select v-model="scope.row.role_id" placeholder="ËØ∑ÈÄâÊã©ËßíËâ≤" @change="my_select(scope.row,scope.$index,'allEditWorkInfo')">
                <el-option
                  v-for="item in admin_role_list"
                  :key="item.role_id"
                  :label="item.role_name"
                  :value="item.role_id"
                />
              </el-select>
            </template>
          </el-table-column>

          <el-table-column  label="Êìç‰Ωú" min-width="120" fixed="right" align="center">
            <template slot-scope="scope">
              <el-button type="text" size="small" class="mr10" @click="all_del_role(scope.$index,'allEditWorkInfo')">Âà†Èô§</el-button>
            </template>
          </el-table-column>

        </el-table>
        <el-button size="small" class="editBtn" @click="all_edit_role">Ê∑ªÂä†</el-button> -->
        <!-- sÊÄªÈó®Â∫óËßíËâ≤ -->
        <!-- sËßíËâ≤ -->
        <div style="margin-top: 10px;"></div>

      </el-form>

      <div slot="footer" class="dialog-footer">
        <el-button type="primary" @click="edit_submit('editForm')">‰øùÂ≠ò‰øÆÊîπ</el-button>
      </div>
    </el-dialog>
    <!-- eÁºñËæëÂëòÂ∑•‰ø°ÊÅØ -->

    <!-- s‰øÆÊîπÂØÜÁ†Å -->
    <el-dialog title="‰øÆÊîπÂØÜÁ†Å" :visible.sync="change_pwd_visible" class="change_pwd" width="50%">

      <el-form ref="changePwdForm" :model="changePwdForm" :rules="changePwdRules">

        <el-form-item label="ÁôªÂΩïÂêçÔºö" :label-width="formLabelWidth" prop="real_name">
          <el-input v-model="changePwdForm.real_name" autocomplete="off" disabled placeholder="ËØ∑ËæìÂÖ•ÁôªÂΩïÂêç" />
        </el-form-item>

        <el-form-item label="ÂØÜÁ†ÅÔºö" :label-width="formLabelWidth" prop="pwd">
          <el-input v-model="changePwdForm.pwd" show-password autocomplete="off" placeholder="6-16‰ΩçÂØÜÁ†ÅÔºåÂøÖÈ°ªÂåÖÂê´Êï∞Â≠óÂ≠óÊØç" />
        </el-form-item>

        <el-form-item label="Á°ÆËÆ§ÂØÜÁ†ÅÔºö" :label-width="formLabelWidth" prop="cPwd">
          <el-input v-model="changePwdForm.cPwd" show-password autocomplete="off" placeholder="6-16‰ΩçÂØÜÁ†ÅÔºåÂøÖÈ°ªÂåÖÂê´Êï∞Â≠óÂ≠óÊØç" />
        </el-form-item>

      </el-form>

      <div slot="footer" class="dialog-footer">
        <el-button type="primary" @click="change_pwd_submit('changePwdForm')">Á°ÆËÆ§</el-button>
      </div>
    </el-dialog>
    <!-- e‰øÆÊîπÂØÜÁ†Å -->

    <!-- sÁºñËæëÂëòÂ∑•Áä∂ÊÄÅ -->
    <el-dialog title="ÁºñËæëÂëòÂ∑•Áä∂ÊÄÅ" :visible.sync="state_visible" :close-on-click-modal="false" class="add_staff" width="70%">
      <el-form ref="stateForm" :model="stateForm" :rules="stateRules">

        <el-form-item label="ÂëòÂ∑•Áä∂ÊÄÅ">
          <el-select
            v-model="stateForm.state_id"
            placeholder="ËØ∑ÈÄâÊã©"
            class="selWidth"
          >
            <el-option
              v-for="item in select_state_list"
              :key="item.id"
              :label="item.name"
              :value="item.id">
            </el-option>
          </el-select>
        </el-form-item>
        <!-- sÊÄªÈó®Â∫óËßíËâ≤ -->
        <el-table :data="allEditWorkInfo" :header-cell-style="{background:'#F5F7FA',color:'#2F3033',fontWeight:'normal'}" style="width: 100%" size="small" highlight-current-row>

          <el-table-column prop="role" label="ÊÄªÂêéÂè∞ËßíËâ≤" min-width="100">
            <template slot-scope="scope">
              <el-select v-model="scope.row.role_id" placeholder="ËØ∑ÈÄâÊã©ËßíËâ≤" @change="my_select(scope.row,scope.$index,'allEditWorkInfo')">
                <el-option
                  v-for="item in admin_role_list"
                  :key="item.role_id"
                  :label="item.role_name"
                  :value="item.role_id"
                />
              </el-select>
            </template>
          </el-table-column>

          <el-table-column  label="Êìç‰Ωú" min-width="120" fixed="right" align="center">
            <template slot-scope="scope">
              <el-button type="text" size="small" class="mr10" @click="all_del_role(scope.$index,'allEditWorkInfo')">Âà†Èô§</el-button>
            </template>
          </el-table-column>

        </el-table>
        <el-button size="small" class="editBtn" @click="all_edit_role">Ê∑ªÂä†</el-button>
        <!-- sÊÄªÈó®Â∫óËßíËâ≤ -->
      </el-form>

      <div slot="footer" class="dialog-footer">
        <el-button type="primary" @click="change_state('stateForm')">Á°ÆËÆ§</el-button>
      </div>
    </el-dialog>
    <!-- eÁºñËæëÂëòÂ∑•Áä∂ÊÄÅ -->

    
  </div>
</template>

<script>
// import { supplie_search, supplie_status_up, supplie_transport_up, supplie_donate_up } from '@/api/charity/application/material'
// var reg_phone = /^1(3[0-9]|4[01456879]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])\d{8}$/
import { admin_search,pwd_update,admin_del,admin_create,admin_details,get_state,set_state } from '@/api/admin'
import { role_search } from '@/api/system_role'
import  localstorage  from '@/utils/localStorage'
// import { mer_search } from '@/api/merchant'

export default {
  name: 'Info',
  data() {
    return {
      new_role : {role_id: ''},
      formLabelWidth: '120px',
      tableData: {
        data: [],
        total: 0
      },
      labelPosition: 'right',
      is_del: 0, // ÊòØÂê¶Â∑≤Âà†Èô§ÂëòÂ∑•ÂàóË°®Ôºå1ÊòØ0Âê¶
      infoForm: {
        page: 1,
        limit: 10,
        is_del: 0,
        admin_type:2,
        mer_id: localstorage.get('admin_info').mer_id,
        provider_id: 0,
        search: '',
        state_id: '',
      },
      groupForm: {
        limit: 1,
        page: 1,
        status: 1,
        is_del: 0,
        is_all: 1,
        is_user: 0
      },
      state_list: [],
      select_state_list: [],
      //ÁªÑÂàóË°®
      // group_list: [],
      //ÊÄªÂêéÂè∞ËßíËâ≤ÂàóË°®
      admin_role_list: [],
      //ÂïÜÂÆ∂ËßíËâ≤ÂàóË°®
      mer_role_list: [],
      //ÂïÜÂÆ∂ÂàóË°®
      mer_list:[],
      // Êñ∞Â¢ûÂëòÂ∑•
      add_visible: false,
      addForm: {
        account: '',
        real_name: '',
        department:'',
        admin_type:2,
        mer_id:localstorage.get('admin_info').mer_id,
        provider_id:0
      },
      // ÊÄªÈó®Â∫óËßíËâ≤
      allAddWorkInfo: [],
      // ËßíËâ≤
      addWorkInfo: [],
      addRules: {
        account: [{ required: true, message: 'ÂëòÂ∑•Â∏êÂè∑‰∏çËÉΩ‰∏∫Á©∫', change: 'blue' }],
        real_name: [{ required: true, message: 'ÂëòÂ∑•ÂßìÂêç‰∏çËÉΩ‰∏∫Á©∫', change: 'blue' }]
      },
      // ÁºñËæë
      // Êñ∞Â¢ûÂëòÂ∑•
      edit_visible: false,
      editForm: {
        admin_id:'',
        account: '',
        real_name: '',
        department:'',
        admin_type:2,
        mer_id:localstorage.get('admin_info').mer_id,
        provider_id:0
      },
      // ÊÄªÈó®Â∫óËßíËâ≤
      allEditWorkInfo: [],
      // ËßíËâ≤
      editWorkInfo: [],
      editRules: {
        account: [{ required: true, message: 'ÂëòÂ∑•Â∏êÂè∑‰∏çËÉΩ‰∏∫Á©∫', change: 'blue' }],
        real_name: [{ required: true, message: 'ÂëòÂ∑•ÂßìÂêç‰∏çËÉΩ‰∏∫Á©∫', change: 'blue' }],
        nickname: [{ required: true, message: 'ÊîØ‰ªòÂÆùÂßìÂêç‰∏çËÉΩ‰∏∫Á©∫', change: 'blue' }],
        alipay_account: [{ required: true, message: 'ÊîØ‰ªòÂÆùÂ∏êÂè∑‰∏çËÉΩ‰∏∫Á©∫', change: 'blue' }],
        group: [{ type: 'number',required: true, message: 'ÂëòÂ∑•ÂàÜÁªÑ‰∏çËÉΩ‰∏∫Á©∫', change: 'blue' }],
        scheduling_mer_id: [{ type: 'number',required: true, message: 'ÊâÄÂ±ûÈó®Â∫ó‰∏çËÉΩ‰∏∫Á©∫', change: 'blue' }],
        is_operator: [{ type: 'number',required: true, change: 'blue' }]
      },
      // ‰øÆÊîπÂØÜÁ†Å
      change_pwd_visible: false,
      changePwdForm: {
        admin_id:'',
        real_name: '',
        pwd: '',
        cPwd: ''
      },
      changePwdRules: {
        pwd: [{ required: true, message: 'ÂØÜÁ†Å‰∏çËÉΩ‰∏∫Á©∫', change: 'blue' }],
        cPwd: [{ required: true, message: 'Á°ÆËÆ§ÂØÜÁ†Å‰∏çËÉΩ‰∏∫Á©∫', change: 'blue' }]
      },

      //ÁºñËæëÂëòÂ∑•Áä∂ÊÄÅ
      state_visible:false,
      stateForm: {
        admin_id: '',
        state_id: '',
        admin_roles_list: []
      },
      stateRules: {
        state_id: [{ required: true, message: 'ÂëòÂ∑•Áä∂ÊÄÅ‰∏çËÉΩ‰∏∫Á©∫', change: 'blue' }],
      },
    }
  },
  mounted() {
    this.get_list('');
    // this.get_group();
    this.get_admin_role();
    // this.get_mer_role();
    // this.get_mer_list();
    this.get_state_list()
  },
  methods: {
    //‰øÆÊîπÂëòÂ∑•Áä∂ÊÄÅ
    change_state(formName) {
      this.$refs[formName].validate(async valid => {
        // Ëã•ÂøÖÂ°´È°π‰∏ç‰∏∫Á©∫
        if (valid) {
          let flag = 0;
          let add_data = {};
          let data = JSON.parse(JSON.stringify(this.allEditWorkInfo));
          this.allEditWorkInfo.forEach(item => {
            if(item.role_id == ''){
              this.$message.error('ËØ∑ÈÄâÊã©ÊÄªÂêéÂè∞ËßíËâ≤ÔºÅ')
              flag = 1
              return false;
            }else{
              this.addWorkInfo.forEach(item => {
                if(item.role_id == ''){
                  this.$message.error('ËØ∑ÈÄâÊã©Èó®Â∫óËßíËâ≤ÔºÅ')
                  flag = 1
                  return false;
                }
                if(item.mer_list.length == 0){
                  this.$message.error('Â∫óÈì∫ËßíËâ≤ÂøÖÈ°ªÊåáÂÆöÊúçÂä°ËåÉÂõ¥„ÄÇ')
                  flag = 1
                  return false;
                }
              })
            }
          })
          if(flag == 0){
            data.push.apply(data,this.addWorkInfo)
            if(data.length == 0){
              this.$message.error('ËØ∑ÂàõÂª∫ËßíËâ≤„ÄÇ')
            }else{
              add_data.admin_id = this.stateForm.admin_id
              add_data.state_id = this.stateForm.state_id
              let data2 = JSON.parse(JSON.stringify(data))
              add_data.admin_roles_list = data2.map(item => {
                return item.role_id
              })

              set_state(add_data)
                .then(res => {
                  this.$message.success('‰øÆÊîπÂëòÂ∑•Áä∂ÊÄÅÊàêÂäüÔºÅ')
                  this.state_visible = false
                  this.stateForm = {
                    admin_id: '',
                    state_id: '',
                    admin_roles_list: []
                  }
                  this.get_list()
                })
                .catch(err => {
                  this.$message.error(err.data.data)
                })
            }

          }
        } else {
          return false
        }
      })
    },
    //ÊâìÂºÄÁºñËæëÂëòÂ∑•Áä∂ÊÄÅÂØπËØùÊ°Ü
    edit_state(e) {
      this.state_visible = true
      this.stateForm.admin_id = e.admin_id
      if(e.admin_roles_list.length != 0) {
        let data = {},all = []
        e.admin_roles_list.forEach(item => {
          data.role_id = item.role_id
          all.push(JSON.parse(JSON.stringify(data)))
        })
        this.allEditWorkInfo = all
      }
      if(e.state_id != 0) {
        this.stateForm.state_id = e.state_id
      }
      
    },
    //ÂëòÂ∑•Áä∂ÊÄÅÂàóË°®
    get_state_list() {
      //Ê≥®ÔºöÊÄªÂêéÂè∞Ôºöadmin_type:0,mer_id:0    ÂïÜÊà∑Á´ØÔºöadmin_type:2,mer_id:localstorage.get('admin_info').mer_id
      get_state({admin_type:2,mer_id:localstorage.get('admin_info').mer_id})
      .then(res => {
        if (res.status === 200) {
          this.select_state_list = JSON.parse(JSON.stringify(res.data))
          res.data.splice(0,0,{id:'',name:'ÂÖ®ÈÉ®'})
          this.state_list = res.data
        }
      }).catch(err => {
        this.$message.error(err.data.data)
      })
    },
    is_max(row){
      if(row.admin_roles_list) {
        let roles = row.admin_roles_list
        let flag = true
        roles.forEach(item => {
          if(item.role_id == 2 || item.role_id ==3 || item.role_id == 4){
            flag = false
          }
        })
        return flag
      }
    },
    get_role_name(row){
      if(row.admin_roles_list) {
        let name = row.admin_roles_list.map(item => {
          return item.role_id__role_name
        })
        return name.join(",")
      }
      
    },
    //ÊâìÂºÄÊñ∞Â¢ûÈ°µÈù¢
    add_click(){
      this.add_visible = true
      this.$nextTick(function () {
        this.$refs['addForm'].resetFields()
      })
      this.allAddWorkInfo = []
      this.addWorkInfo = []
    },
    //Ê†πÊçÆadmin_idÂèñÁî®Êà∑‰ø°ÊÅØ
    get_admin_by_id(id){
      this.allEditWorkInfo = []
      this.editWorkInfo = []
      let all = []
      let edit = []
      admin_details(id)
        .then(res => {
          let all = [];
          let edit = [];
          let data = {};
          this.editForm.admin_id = id
          this.editForm.account = res.data.account
          this.editForm.real_name = res.data.real_name
          this.editForm.department = res.data.department
          this.editForm.admin_type = res.data.admin_type
          this.editForm.mer_id = res.data.mer_id
          this.editForm.provider_id = res.data.provider_id
          res.data.admin_roles_list.forEach(item => {
            data.role_id = item.role_id
            all.push(JSON.parse(JSON.stringify(data)))
          })
          this.allEditWorkInfo = all
        })
        .catch(err => {
          console.log(err)
        })
    },
    //Ê£ÄÊµãÂ∏êÂè∑
    check_account(data){
      let reg_phone = /^1(3[0-9]|4[01456879]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])\d{8}$/
      if(!reg_phone.test(data)){
        this.$message.error("Â∏êÂè∑ÂøÖÈ°ª‰∏∫ÊâãÊú∫Âè∑Á†Å")
        this.addForm.account = ''
      }
    },
    my_select(row,index,data){
      let new_data;
      new_data = JSON.parse(JSON.stringify(this.[data]))
      new_data.splice(index,1)
      if(new_data.length > 0){
        if(new_data.filter(item => item.role_id == row.role_id).length > 0){
          this.$message.error('ËØ•ËßíËâ≤Â∑≤ÈÄâÔºåËØ∑‰∏çË¶ÅÈáçÂ§çÈÄâÂèñ„ÄÇ')
          this.[data][index].role_id = ''
        }
      }
    },
    //ÂèñÊâÄÊúâÈó®Â∫ó
    async get_mer_list(){
      // await mer_search({search:'',page:1,limit:''})
      //   .then(res => {
      //     this.mer_list = res.data.items
      //   })
      //   .catch(err =>{
      //     this.$message.error(err.data.data)
      //   })
    },
    //ÂèñÊÄªÂêéÂè∞ËßíËâ≤
    async get_admin_role(){
      await role_search({role_type:2,mer_id:localstorage.get('admin_info').mer_id,provider_id:0,is_developers:0})
        .then(res => {
          this.admin_role_list = res.data
        })
        .catch(err => {
          this.$message.error(res.data.data)
        })
    },
    //ÂèñÂïÜÊà∑ÂêéÂè∞ËßíËâ≤
    async get_mer_role(){
      await role_search({is_mer:1})
        .then(res =>{
          this.mer_role_list = res.data
        })
        .catch(err => {
          this.$message.error(res.data.data)
        })
    },
    // //ÂèñÊâÄÊúâÂàÜÁªÑ‰ø°ÊÅØ
    // async get_group(){
    //   await group_search(this.groupForm)
    //           .then(res =>{
    //             this.group_list = res.data
    //           })
    //           .catch(err =>{
    //             this.$message.error(err.data.data)
    //           })
    //   },

    //Êü•ËØ¢
    info_search() {
      this.get_list(1)
    },
    // ÂàóË°®
    get_list(num) {
      this.infoForm.page = num || this.infoForm.page
      const param = this.infoForm
      admin_search(param)
      .then(res => {
        this.tableData.data = res.data.items
        this.tableData.total = res.data.total
      }).catch(res => {
      })
    },
    //ÂàÜÈ°µ
    page_change(page) {
      this.infoForm.page = page
      this.get_list('')
    },
    handle_size_change(val) {
      this.infoForm.limit = val
      this.get_list('')
    },
    // ÈáçÁΩÆ
    reset() {
      this.infoForm = {
        page: 1,
        limit: 10,
        is_del: 0,
        admin_type:2,
        mer_id: localstorage.get('admin_info').mer_id,
        provider_id: 0,
        search: '',
      }
      this.is_del = 0;
      this.get_list('')
    },
    // ‰øÆÊîπÂØÜÁ†Å
    change_pwd(e) {
      this.changePwdForm.admin_id = e.admin_id
      this.changePwdForm.real_name = e.real_name
      this.change_pwd_visible = true
    },
    // ÁºñËæë
    edit(e) {
      this.get_admin_by_id(e)
      this.edit_visible = true
    },
    // Âà†Èô§
    del(e) {
      this.$confirm('Á°ÆÂÆöÂà†Èô§ËØ•Áî®Êà∑?', 'ÊèêÁ§∫', {
        confirmButtonText: 'Á°ÆÂÆö',
        cancelButtonText: 'ÂèñÊ∂à',
        type: 'warning'
      }).then(() => {
        admin_del({admin_id:e.admin_id,is_del:1})
          .then(res=>{
            this.$message.success('Âà†Èô§Áî®Êà∑ÊàêÂäüÔºÅ')
            this.get_list()
          })
      }).catch(() => {});
    },
    // ÊÅ¢Â§ç
    recover(e) {
      this.$confirm('ÊòØÂê¶ÊÅ¢Â§çËØ•Áî®Êà∑?', 'ÊèêÁ§∫', {
        confirmButtonText: 'Á°ÆÂÆö',
        cancelButtonText: 'ÂèñÊ∂à',
        type: 'warning'
      }).then(() => {
        admin_del({admin_id:e.admin_id,is_del:0})
          .then(res=>{
            this.$message.success('ÊÅ¢Â§çÁî®Êà∑ÊàêÂäüÔºÅ')
            this.get_list()
          })
      }).catch(() => {});
    },
    // Â∑≤Âà†Èô§ÂëòÂ∑•
    had_del_staff() {
      this.infoForm = {
        page: 1,
        limit: 10,
        is_del: 1,
        admin_type:2,
        mer_id: localstorage.get('admin_info').mer_id,
        provider_id: 0,
        search: '',
      }
      this.is_del = 1;
      this.get_list('')
    },
    //Âú®Á∫øÂëòÂ∑•
    had_nodel_staff() {
      this.infoForm = {
        page: 1,
        limit: 10,
        is_del: 0,
        admin_type:2,
        mer_id: localstorage.get('admin_info').mer_id,
        provider_id: 0,
        search: '',
      }
      this.is_del = 0;
      this.get_list('')
    },
    // sÊñ∞Â¢ûÂëòÂ∑•
    // ÊÄªËßíËâ≤-Ê∑ªÂä†
    all_add_role() {
      this.allAddWorkInfo.push(JSON.parse(JSON.stringify(this.new_role)))
    },
    // // ÊÄªËßíËâ≤-Âà†Èô§
    // all_del_role(e) {
    //   console.log(e)
    // },
    // ËßíËâ≤-Ê∑ªÂä†
    add_role() {
      this.addWorkInfo.push(JSON.parse(JSON.stringify(this.new_role)))
    },
    // ËßíËâ≤-Âà†Èô§
    mer_del_role(index,data) {
      this.[data].splice(index,1)
    },
    // ‰øùÂ≠ò‰øÆÊîπ
    add_submit(formName) {
      this.$refs[formName].validate(async valid => {
        // Ëã•ÂøÖÂ°´È°π‰∏ç‰∏∫Á©∫
        if (valid) {
          // let flag = 0;
          let add_data = {};
          // let data = JSON.parse(JSON.stringify(this.allAddWorkInfo));
          // this.allAddWorkInfo.forEach(item => {
          //   if(item.role_id == ''){
          //     this.$message.error('ËØ∑ÈÄâÊã©ÊÄªÂêéÂè∞ËßíËâ≤ÔºÅ')
          //     flag = 1
          //     return false;
          //   }else{
          //     this.addWorkInfo.forEach(item => {
          //       if(item.role_id == ''){
          //         this.$message.error('ËØ∑ÈÄâÊã©Èó®Â∫óËßíËâ≤ÔºÅ')
          //         flag = 1
          //         return false;
          //       }
          //       if(item.mer_list.length == 0){
          //         this.$message.error('Â∫óÈì∫ËßíËâ≤ÂøÖÈ°ªÊåáÂÆöÊúçÂä°ËåÉÂõ¥„ÄÇ')
          //         flag = 1
          //         return false;
          //       }
          //     })
          //   }
          // })
          // if(flag == 0){
          //   data.push.apply(data,this.addWorkInfo)
          //   if(data.length == 0){
          //     this.$message.error('ËØ∑ÂàõÂª∫ËßíËâ≤„ÄÇ')
          //   }else{
              add_data.account = this.addForm.account
              add_data.real_name = this.addForm.real_name
              add_data.department = this.addForm.department
              add_data.admin_type = this.addForm.admin_type
              add_data.mer_id = this.addForm.mer_id
              add_data.provider_id = this.addForm.provider_id
              // let data2 = JSON.parse(JSON.stringify(data))
              // add_data.admin_roles_list = data2.map(item => {
              //   return item.role_id
              // })

              admin_create(add_data)
                .then(res => {
                  this.$message.success('Êñ∞Â¢ûÊàêÂäüÔºÅ')
                  this.add_visible = false
                  this.get_list()
                })
                .catch(err => {
                  this.$message.error(err.data.data)
                })
            }

          // }
      //   } else {
      //     return false
      //   }
      })
    },
    // eÊñ∞Â¢ûÂëòÂ∑•

    // sÁºñËæëÂëòÂ∑•
    // ÊÄªËßíËâ≤-Ê∑ªÂä†
    all_edit_role() {
      this.allEditWorkInfo.push(JSON.parse(JSON.stringify(this.new_role)))
    },
    // ÊÄªËßíËâ≤-Âà†Èô§
    all_del_role(index,data) {
      this.[data].splice(index,1)
    },
    // ËßíËâ≤-Ê∑ªÂä†
    edit_role() {
      this.editWorkInfo.push(JSON.parse(JSON.stringify(this.new_role)))
    },
    // ËßíËâ≤-Âà†Èô§
    // del_role(e) {
    //   this.$confirm('Ê≠§Êìç‰ΩúÂ∞ÜÊ∞∏‰πÖÂà†Èô§ËØ•Êñá‰ª∂, ÊòØÂê¶ÁªßÁª≠?', 'ÊèêÁ§∫', {
    //     confirmButtonText: 'Á°ÆÂÆö',
    //     cancelButtonText: 'ÂèñÊ∂à',
    //     type: 'warning'
    //   }).then(() => {
    //     this.$message({
    //       type: 'success',
    //       message: 'Âà†Èô§ÊàêÂäü!'
    //     });
    //   }).catch(() => {
    //     this.$message({
    //       type: 'info',
    //       message: 'Â∑≤ÂèñÊ∂àÂà†Èô§'
    //     });
    //   });
    // },
    // ‰øùÂ≠ò‰øÆÊîπ
    edit_submit(formName) {
      this.$refs[formName].validate(async valid => {
        // Ëã•ÂøÖÂ°´È°π‰∏ç‰∏∫Á©∫
        if (valid) {
          // let flag = 0;
          let add_data = {};
          // let data = JSON.parse(JSON.stringify(this.allEditWorkInfo));
          // this.allEditWorkInfo.forEach(item => {
          //   if(item.role_id == ''){
          //     this.$message.error('ËØ∑ÈÄâÊã©ÊÄªÂêéÂè∞ËßíËâ≤ÔºÅ')
          //     flag = 1
          //     return false;
          //   }else{
          //     this.editWorkInfo.forEach(item => {
          //       if(item.role_id == ''){
          //         this.$message.error('ËØ∑ÈÄâÊã©Èó®Â∫óËßíËâ≤ÔºÅ')
          //         flag = 1
          //         return false;
          //       }
          //       if(item.mer_list.length == 0){
          //         this.$message.error('Â∫óÈì∫ËßíËâ≤ÂøÖÈ°ªÊåáÂÆöÊúçÂä°ËåÉÂõ¥„ÄÇ')
          //         flag = 1
          //         return false;
          //       }
          //     })
          //   }
          // })
          // if(flag == 0){
          //   data.push.apply(data,this.editWorkInfo)
          //   if(data.length == 0){
          //     this.$message.error('ËØ∑ÂàõÂª∫ËßíËâ≤„ÄÇ')
          //   }else{
              add_data.admin_id = this.editForm.admin_id
              add_data.account = this.editForm.account
              add_data.real_name = this.editForm.real_name
              add_data.department = this.editForm.department
              add_data.admin_type = this.editForm.admin_type
              add_data.mer_id = this.editForm.mer_id
              add_data.provider_id = this.editForm.provider_id
              // let data2 = JSON.parse(JSON.stringify(data))
              // add_data.admin_roles_list = data2.map(item => {
              //   return item.role_id
              // })
              admin_create(add_data)
                .then(res => {
                  this.$message.success('‰øÆÊîπÊàêÂäüÔºÅ')
                  this.edit_visible = false
                  this.get_list()
                })
                .catch(err => {
                  this.$message.error(err.data.data)
                })
            }

          // }
        // } else {
        //   return false
        // }
      })
    },
    // eÁºñËæëÂëòÂ∑•

    // ‰øÆÊîπÂØÜÁ†Å--Á°ÆËÆ§
    change_pwd_submit(formName) {
      this.$refs[formName].validate(async valid => {
        // Ëã•ÂøÖÂ°´È°π‰∏ç‰∏∫Á©∫
        if (valid) {
          if(this.changePwdForm.pwd != this.changePwdForm.cPwd){
            this.$message.error("‰∏§Ê¨°ËæìÂÖ•ÁöÑÂØÜÁ†Å‰∏çÁõ∏ÂêåÔºåËØ∑ÈáçÊñ∞ËæìÂÖ•ÔºÅ")
            this.changePwdForm.pwd = '';
            this.changePwdForm.cPwd = '';
          }else{
            pwd_update({admin_id:this.changePwdForm.admin_id,new_pwd:this.changePwdForm.cPwd})
              .then(res =>{
                this.$message.success('Êõ¥ÊîπÂØÜÁ†ÅÊàêÂäüÔºÅ')
                this.change_pwd_visible = false
              })
              .catch(err =>{
                this.$message.error(err.data.data)
              })
          }
        } else {
          return false
        }
      })
    }
  }
}
</script>

<style lang="scss">
::deep [type=reset],
[type=submit],
button,
html [type=button] {
    -webkit-appearance: none !important;
}
.info{
  .box-card {
    margin: 20px 20px
  }

  .container {
      min-width: 821px;
  }

  .block{
    float: right;
  }
  .demo-table-expand {
    font-size: 0;
  }
  .demo-table-expand label {
    width: 90px;
    color: #99a9bf;
  }
  .demo-table-expand .el-form-item {
    margin-right: 0;
    margin-bottom: 0;
    width: 50%;
  }
  .add_staff{
    .el-form-item{
      margin-bottom: 20px;
    }
    ::v-deep .el-input__inner{
      text-align: left;
    }
  }
  .el-input__inner{
    text-align: left;
  }
  .end_input{
    display: block;
    position: absolute;
    top: 1px;
    left: 140px;
    width: 40px;
    height: 38px;
    line-height: 38px;
    border-radius: 0 8px 8px 0;
    font-size: 14px;
    color: #111111;
    text-align: center;
    background: rgba(0, 0, 0, 0.02);
  }
  .addBtn{
    margin-top: 10px;
  }
}

</style>
